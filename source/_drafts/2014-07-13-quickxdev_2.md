title: QuickxDev插件(二) 快捷键启动Player
date: 2014-07-13 07:06:29
tags: [sublime,quick-cocos2d-x]
categories: [QuickxDev]
---

一. 分析

1.为什么之前没有快捷键启动?

其中一个原因是因为作者觉得没有必要, 另一个原因可能是因为**路径**的问题. 我们来看一下启动`Run With Player`的部分代码:

```python
def is_enabled(self, dirs): #是否可用? dirs 侧边栏右键时对应文件夹的路径
	if len(dirs)!=1:
		return False
	mainLuaPath=dirs[0]+"/main.lua"
	if not os.path.exists(mainLuaPath):
		return False
	return True

def is_visible(self, dirs): #是否显示?
	return self.is_enabled(dirs)
```

从上面的这句`dirs[0]+"/main.lua"`代码中可以看出插件是根据路径下是否包含有`main.lua`来判断是否显示`Run With Player`菜单的,那么只有在`scripts`上右键才会显示出来.
另一个比较重要的时`dirs`参数, 这个参数是你在侧边栏右键点击时对应文件夹的路径, 这个路径只有当你点击是才会传入, 而使用快捷键我们是无法获取这个路径的.

2.如何获取路径?

```python
def getProjectRootPath(filepath):
	root_path = ""
	keys = ("proj.android/","proj.ios/","proj.mac/","proj.win32/","res/","scripts/","sources/")
	for key in keys:
		find_index = filepath.find(key)
		if find_index != -1:
			root_path = filepath[:find_index - 1]
			if os.path.isfile(root_path+"/scripts/main.lua"):
				break

			root_path = ""

	return root_path
```