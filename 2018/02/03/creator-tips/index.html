<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="UTF-8">

    

    

    <title>最近使用 CocosCreaor 遇到的问题及解决方案 | Justbilt</title>
    <meta name="author" content="justbilt">
    <meta name="version" content="1.0.0">
    <meta name="keywords" content="">
    <meta name="description" content="最近两个月, 我们一直在用 CocosCreator 做一个休闲游戏, 在享受 Creator 高效的过程中我们也遇到了这样那样的问题. 有些问题是我们的用法不正确, 有些则是引擎和编辑器的 bug, 好在这些问题基本上都解决了. 今天我和大家分享下我们团队在使用 CocosCreaor 遇到的问题及解决方案.Web 篇Failed to load resource: net::ERR_BLOCKED_BY_CLIENT解决方案:如果你的浏览器装了广告过滤插件的话, 可能是某个...">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">

    
    <link rel="alternate" href="/atom.xml" title="Justbilt" type="application/atom+xml">
    
    
    <link rel="icon" href="/favicon/favicon.png">
    

    <link rel="stylesheet" href="/css/style.css">
</head>
<body>

    <main class="app">
        <header class="header clearfix">
    <div id="nav" class="nav">
    <div class="nav-mobile">
        <button id="open-panel" class="open-panel nav-mobile-item"><i class="icon-documents"></i></button>
        <h1 class="nav-mobile-title nav-mobile-item">Justbilt</h1>
        <button id="open-menus" class="open-panel nav-mobile-item"><i class="icon-library"></i></button>
    </div>

    <nav id="nav-inner" class="nav-inner">
        
            <a class="nav-item" href="/">
                <span class="nav-text">首页</span>
            </a>
        
            <a class="nav-item" href="/tags/Cocos2d-x/">
                <span class="nav-text">Cocos</span>
            </a>
        
            <a class="nav-item" href="/tags/年结/">
                <span class="nav-text">年结</span>
            </a>
        
            <a class="nav-item" href="/tags">
                <span class="nav-text">标签</span>
            </a>
        
            <a class="nav-item" href="/archives">
                <span class="nav-text">归档</span>
            </a>
        
            <a class="nav-item" href="/atom.xml">
                <span class="nav-text">订阅</span>
            </a>
        
            <a class="nav-item" href="/about">
                <span class="nav-text">关于</span>
            </a>
        
    </nav>
</div>

    <aside id="aside" class="aside">
    <div id="aside-mask" class="aside-mask"></div>
    <div id="aside-inner" class="aside-inner">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"><i class="icon-search-stroke"></i></button><input type="hidden" name="sitesearch" value="http://blog.justbilt.com"></form>

        
        
        
        

        
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Web-篇"><span class="toc-number">1.</span> <span class="toc-text">Web 篇</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Native-篇"><span class="toc-number">2.</span> <span class="toc-text">Native 篇</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Web-和-Native-API-适配篇"><span class="toc-number">3.</span> <span class="toc-text">Web 和 Native API 适配篇</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#诡异现象篇"><span class="toc-number">4.</span> <span class="toc-text">诡异现象篇</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#认知篇"><span class="toc-number">5.</span> <span class="toc-text">认知篇</span></a></li></ol>
        
    </div>
</aside>

</header>

        <div id="content" class="content"><article class="article" itemscope="" itemprop="blogPost">
    
    <header class="article-header">
        
        <h1 itemprop="name">
            最近使用 CocosCreaor 遇到的问题及解决方案
        </h1>
        
        <div class="article-meta clearfix">
            <a class="article-date" href="http://blog.justbilt.com/2018/02/03/creator-tips/index.html">
    
    <i class="icon-calendar"></i>
    
    <time datetime="2018-02-03T03:01:23.000Z" itemprop="datePublished">2018-02-03</time>
</a>

            
<div class="article-tag-list">
    <i class="icon-tag"></i>
    <a class="article-tag-link" href="/tags/CocosCreaor/">CocosCreaor</a>
</div>


        </div>
    </header>
    
    <section class="article-body markdown-body">
        
        <p>最近两个月, 我们一直在用 CocosCreator 做一个休闲游戏, 在享受 Creator 高效的过程中我们也遇到了这样那样的问题. 有些问题是我们的用法不正确, 有些则是引擎和编辑器的 bug, 好在这些问题基本上都解决了. </p>
<p>今天我和大家分享下我们团队在使用 CocosCreaor 遇到的问题及解决方案.</p>
<a id="more"></a>
<h1 id="Web-篇"><a href="#Web-篇" class="headerlink" title="Web 篇"></a>Web 篇</h1><blockquote>
<p>Failed to load resource: net::ERR_BLOCKED_BY_CLIENT</p>
</blockquote>
<p>解决方案:<br>如果你的浏览器装了广告过滤插件的话, 可能是某个文件拦截了, 在这个页面上停用广告拦截插件就行了.</p>
<blockquote>
<p>No ‘Access-Control-Allow-Origin’ header is present on the requested </p>
</blockquote>
<p>解决方案:<br>跨域问题, 如果是在开发阶段遇到的话, 我们可以先尝试绕过这个问题. 常用的方案有两个:</p>
<ol>
<li>使用 Chrome 插件</li>
<li>启动 Chrome 时加入允许跨域的参数</li>
</ol>
<p>可以参考<a href="https://hectorguo.com/zh/cross-origin-solve/" target="_blank" rel="noopener">这篇</a>进行配置, 第一个方案有时候会失效, 还是第二个方案最稳妥.</p>
<blockquote>
<p>Can not find deps [xxx] for path : preview-scripts/assets/Script/xxx.js</p>
</blockquote>
<p>解决方案:<br>浏览器提示找不到某个文件, 其实是有两个重名的文件放在不同的目录, 改成不一样的文件名就好了.</p>
<h1 id="Native-篇"><a href="#Native-篇" class="headerlink" title="Native 篇"></a>Native 篇</h1><blockquote>
<p>调用 Objc 函数失败, 提示找不到函数</p>
</blockquote>
<p>解决方案:<br>Objc 函数如果有任何参数的话, 函数名称最后都要加 <code>:</code>, quick 之前是自动补了这个. Objc 函数不支持 NSObject 类型, 只支持基本类型, 之前 quick 都是通过 NSDictory 进行传参的.</p>
<blockquote>
<p>iOS 运行无日志输出</p>
</blockquote>
<p>解决方案:<br>binary 模板生成的 iOS 工程出错后没有堆栈信息, 换成了 link/default 模板就解决了, 推测可能是 <code>binary</code> 模板使用的是 Reaease 版的配置编译出的 <code>.a</code>, 因此没有日志.</p>
<blockquote>
<p>Android Studio 调试启动很慢</p>
</blockquote>
<p>将下图这里改成 <code>Java</code> 就好了, 只是不能 debug c++ 代码了.</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1fo332dei7nj31kw12178h.jpg" alt=""></p>
<blockquote>
<p>error: undefined reference to ‘bsd_signal’</p>
</blockquote>
<p>解决方案：<br>修改 gradle.properties:</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PROP_TARGET_SDK_VERSION=<span class="number">10</span> <span class="comment">//21 就会报上面的错误</span></span><br></pre></td></tr></table></figure>
<h1 id="Web-和-Native-API-适配篇"><a href="#Web-和-Native-API-适配篇" class="headerlink" title="Web 和 Native API 适配篇"></a>Web 和 Native API 适配篇</h1><blockquote>
<p>atob 和 btoa</p>
</blockquote>
<p>这两个 API 只有 web 上有, Native 上没有, 只能自己实现, 我是使用 cryto.js 实现的:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">base64Encode</span>(<span class="params">str: <span class="built_in">string</span></span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> CryptoJS.enc.Base64.stringify(CryptoJS.enc.Utf8.parse(str));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">base64Decode</span>(<span class="params">str: <span class="built_in">string</span></span>): <span class="title">string</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> CryptoJS.enc.Base64.parse(str).toString(CryptoJS.enc.Utf8);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>cc.log </p>
</blockquote>
<p>在 Native 上无法输出 Object 类型的变量, 可以利用 Json 自己实现:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> _log = cc.log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (cc.sys.isNative) &#123;</span><br><span class="line">    <span class="comment">// tslint:disable-next-line:only-arrow-functions</span></span><br><span class="line">    cc.log = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> arg = [];</span><br><span class="line">        <span class="comment">// tslint:disable-next-line:prefer-for-of</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; <span class="built_in">arguments</span>.length; index++) &#123;</span><br><span class="line">            <span class="keyword">const</span> element = <span class="built_in">arguments</span>[index];</span><br><span class="line">            <span class="keyword">switch</span> (<span class="keyword">typeof</span> element) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">"object"</span>:</span><br><span class="line">                    arg.push(<span class="built_in">JSON</span>.stringify(element));</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    arg.push(element);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        _log(arg.join(<span class="string">" "</span>));</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>WebSocket/XMLHttpRequest</p>
</blockquote>
<p>OPEN/CONNECTING/CLOSING/CLOSED 属性在 Native 无定义, 自己实现:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">enum</span> SocketStatus &#123;</span><br><span class="line">    OPEN =  <span class="number">1</span>,</span><br><span class="line">    CONNECTING =  <span class="number">2</span>,</span><br><span class="line">    CLOSING =  <span class="number">3</span>,</span><br><span class="line">    CLOSED =  <span class="number">4</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同理, XMLHttpRequest.DONE(4) 也是没有定义的, 得自己定义或者直接写数字.</p>
<blockquote>
<p>unschedule</p>
</blockquote>
<p>unschedule 在 Native 时会额外判断 <code>__callbackId</code>, 这个id是在调用 schedule 时赋值的, 所以以下做法会出错:</p>
<ol>
<li>schedule 时传入 <code>this.xxx.bind(this)</code></li>
<li>unschedule 先于 schedule 执行</li>
</ol>
<p>schedule 函数没有返回 handle, 因此没有办法判断是否 schedule 过, 所以还是用 update 来做计时器.</p>
<blockquote>
<p>JS Exception: null is not a function, file: <no filename="">, lineno: 0</no></p>
</blockquote>
<p>解决方案：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cc.director.getScheduler().scheduleUpdate(this, 1, false, this.onTimer);</span><br></pre></td></tr></table></figure>
<p>如果 this 不是继承自 <code>cc.Component</code> 的话就会持续的触发这个错误.</p>
<h1 id="诡异现象篇"><a href="#诡异现象篇" class="headerlink" title="诡异现象篇"></a>诡异现象篇</h1><blockquote>
<p>工程怎么同步都不是最新的代码, 控制台看到了 <code>会话过期</code> 字样</p>
</blockquote>
<p>解决方案：<br>重启 Creator , 猜测是在 git pull 的同时打开了 creator 的原因</p>
<blockquote>
<p>启动后游戏背景是蓝色的</p>
</blockquote>
<p>解决方案：<br>之前从测试用例工程拷贝过来的 <code>cases-settings.js</code> 中设置了清屏颜色, </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cc.director.setClearColor( cc.hexToColor(<span class="string">'#2f69d2'</span>) );</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Creator 打开项目卡死</p>
</blockquote>
<p>解决方案：<br>把整个 assets 目录清空, 能够打开了. 随后通过 git 还原 assets 目录, 就可以正常打开了. 详细过程可以看我在论坛中发的<a href="http://forum.cocos.com/t/1-6-2-mac/54449" target="_blank" rel="noopener">这篇帖子</a>.</p>
<blockquote>
<p>preloadScene 调用后 http 请求收不到 response</p>
</blockquote>
<p>解决方案：<br>c++ 侧断点跟踪后, 确实是收到 Response 了, 但是没有调用到 js 这边, 将 <code>onreadystatechange</code> 事件由匿名函数改为成员函数后解决.</p>
<blockquote>
<p>localStorage 无法保存存档</p>
</blockquote>
<p>解决方案：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cc.sys.localStorage.setItem(“storage&quot;, &quot;world&quot;);</span><br></pre></td></tr></table></figure>
<p>经过排查, 是某些特殊关键字无法存储成功成功, 设置后本次回话有效, 关闭标签后再打开就没有了, 换一个 key 就好了.</p>
<h1 id="认知篇"><a href="#认知篇" class="headerlink" title="认知篇"></a>认知篇</h1><ol>
<li>Event 不能持有对象, 因为 EventPool, 你持有的对象属性会发生变化.</li>
<li>在 onLoad 之前 active 置为 false 将导致不会触发 onLoad 事件, 直到下次 avtive 为 true 时才会触发.</li>
<li>动画时间轴, 并不是不等分, 而是前面是秒数, 后面是帧数, 30 就是 1 秒的一半.</li>
</ol>

        
    </section>
</article>



</div>
        <footer class="footer">
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, Theme by <a href="https://github.com/sanonz/hexo-theme-concise" target="_blank">Concise</a>

    
        &ensp;
        <span id="cnzz_stat_icon_1271274815" class="vm"></span>
        <script src="//s13.cnzz.com/stat.php?id=1271274815&show=pic" type="text/javascript"></script>
    
</footer>

    </main>

    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/1.9.0/jquery.min.js"></script>
    <script type="text/javascript">
    $(function() {
        var nodes = {
            nav: $('#nav'),
            aside: $('#aside'),
            asideInner: $('#aside-inner'),
            navInner: $('#nav-inner')
        };

        var doing = false;
        nodes.asideInner.on('webkitAnimationEnd mozAnimationEnd oAnimationEnd oanimationend animationend', function() {
            if (nodes.aside.hasClass('mobile-open')) {
                nodes.aside.removeClass('mobile-open');
            } else {
                nodes.aside.removeClass('mobile-close panel-show');
            }
            doing = false;
        });
        $('#open-panel, #aside-mask').on('click', function() {
            if (doing) {
                return;
            }
            
            if (nodes.aside.hasClass('panel-show')) {
                nodes.aside.addClass('mobile-close');
            } else {
                nodes.aside.addClass('mobile-open panel-show');
            }
        });
        $('#open-menus').on('click', function() {
            nodes.navInner.slideToggle();
        });

        if (window.innerWidth <= 960) {
            setTimeout(function() {
                nodes.navInner.slideUp();
            }, 3000);
        }
    });
    </script>
    
        <script type="text/javascript" src="/js/scrollspy.min.js"></script>
        <script type="text/javascript">
        $(document.body).scrollspy({target: '#aside-inner'});
        </script>
    

</body>
</html>
